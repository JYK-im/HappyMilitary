<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í–‰êµ°(í–‰ë³µí•œ êµ°ìƒí™œ) | êµ°ìƒí™œì˜ ëª¨ë“  ì •ë³´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #121418; color: #e1e1e1; overflow-x: hidden; }
        .accent-khaki { color: #8a9a5b; } 
        .bg-card { background-color: #1c1f26; border: 1px solid #2d333e; }
        .btn-khaki { background-color: #8a9a5b; color: #121418; font-weight: bold; }
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #121418; }
        ::-webkit-scrollbar-thumb { background: #2d333e; border-radius: 5px; }
    </style>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase í”„ë¡œì íŠ¸ ì„¤ì • (ë³¸ì¸ì˜ ì„¤ì •ê°’ìœ¼ë¡œ êµì²´ í•„ìš”)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_MESSAGING_ID",
        appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();
    const provider = new GoogleAuthProvider();

    // ì „ì—­ ìƒíƒœì— í• ë‹¹
    window.auth = auth;
    window.db = db;
    window.provider = provider;
    window.signInWithPopup = signInWithPopup;
    window.signOut = signOut;
    window.doc = doc;
    window.getDoc = getDoc;
    window.setDoc = setDoc;
    window.updateDoc = updateDoc;
</script>

</head>
<body class="p-4 md:p-6">

    <header class="max-w-7xl mx-auto flex justify-between items-center py-6 mb-8 border-b border-gray-800">
        <div class="flex items-center gap-3">
            <div class="bg-[#8a9a5b] p-2 rounded-lg shadow-lg shadow-khaki/20">
                <i class="fa-solid fa-person-military-pointing text-black text-2xl"></i>
            </div>
            <div>
                <h1 class="text-3xl font-black text-white tracking-tighter">
                    <span class="accent-khaki text-[40px]">í–‰</span>ë³µí•œ 
                    <span class="accent-khaki text-[40px]">êµ°</span>ìƒí™œ
                </h1>
                <p class="text-[10px] text-gray-500 font-bold tracking-widest uppercase italic leading-none mt-1">Happy Military Community</p>
            </div>
        </div>
        <div id="authArea" class="flex items-center gap-3">
            <div class="hidden md:flex gap-2">
                <button onclick="alert('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì¤€ë¹„ ì¤‘')" class="bg-[#FEE500] text-black text-[10px] px-3 py-1.5 rounded-full font-bold">ì¹´ì¹´ì˜¤</button>
                <button onclick="alert('ë„¤ì´ë²„ ë¡œê·¸ì¸ ì¤€ë¹„ ì¤‘')" class="bg-[#03C75A] text-white text-[10px] px-3 py-1.5 rounded-full font-bold">ë„¤ì´ë²„</button>
            </div>
            <button id="loginBtn" onclick="loginWithGoogle()" class="text-xs bg-white text-black px-5 py-2 rounded-full font-bold hover:bg-gray-200 transition-all">êµ¬ê¸€ ë¡œê·¸ì¸</button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 xl:grid-cols-4 gap-6">
        
        <div class="xl:col-span-1 space-y-6">
            <section class="bg-card p-5 rounded-2xl shadow-xl">
                <h2 class="text-sm font-bold mb-4 accent-khaki flex items-center gap-2 border-b border-gray-800 pb-2">
                    <i class="fa-solid fa-fire"></i> ì‹¤ì‹œê°„ ì¸ê¸°ê¸€
                </h2>
                <div id="hotPosts" class="space-y-4 text-xs">
                    <div class="group cursor-pointer">
                        <p class="font-bold truncate group-hover:text-[#8a9a5b]">2026ë…„ êµ°ì¸ ì›”ê¸‰ ì§€ê¸‰ì¼ ë° ì¸ìƒë¶„ ì •ë¦¬</p>
                        <span class="text-[10px] text-gray-600">ëŒ“ê¸€ 32ê°œ Â· 10ë¶„ ì „</span>
                    </div>
                    <div class="group cursor-pointer">
                        <p class="font-bold truncate group-hover:text-[#8a9a5b]">ì˜ì™¸ë§ˆíŠ¸(WA) ê°€ì¡± ë“±ë¡ ì ˆì°¨ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤</p>
                        <span class="text-[10px] text-gray-600">ëŒ“ê¸€ 18ê°œ Â· 25ë¶„ ì „</span>
                    </div>
                </div>
            </section>

            <section class="space-y-3">
                <a href="https://blog.naver.com" target="_blank" class="block bg-card p-4 rounded-xl border border-gray-800 hover:border-[#8a9a5b] transition-all group">
                    <p class="text-[10px] accent-khaki font-bold mb-1">í–‰êµ° ê³µì‹ ë¸”ë¡œê·¸</p>
                    <p class="font-bold text-sm group-hover:underline text-white">êµ°ì¸ê°€ì¡± í˜œíƒ ê°€ì´ë“œ ë³´ê¸° â†’</p>
                </a>
                <a href="#" class="block bg-[#8a9a5b] p-4 rounded-xl text-black transition-transform hover:scale-[1.02]">
                    <p class="text-[10px] font-bold opacity-80">ì¶”ì²œ ì„œë¹„ìŠ¤</p>
                    <p class="font-bold text-sm">êµ­ë°©ë³µì§€í¬í„¸ í˜œíƒ í™•ì¸</p>
                </a>
            </section>
        </div>

        <div class="xl:col-span-2 space-y-6">
            
            <section class="bg-card p-6 rounded-2xl shadow-lg border-b border-[#8a9a5b]/30">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold flex items-center gap-2">
                        <i class="fa-solid fa-thumbtack accent-khaki"></i> ì£¼ìš” ì •ë³´ ì—…ë°ì´íŠ¸
                    </h2>
                    <button class="text-[10px] text-gray-500 hover:text-white transition-colors">ì „ì²´ë³´ê¸° +</button>
                </div>
                
                <div class="grid grid-cols-1 gap-4">
                    <div class="group cursor-pointer p-4 bg-black/20 rounded-xl border border-gray-800 hover:border-[#8a9a5b] transition-all">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[9px] bg-[#8a9a5b] text-black px-2 py-0.5 rounded font-bold uppercase tracking-tighter">ì´ˆê¸‰ê°„ë¶€</span>
                            <span class="text-[10px] text-gray-600 font-medium">2026.01.05</span>
                        </div>
                        <h3 class="font-bold text-sm group-hover:text-[#8a9a5b] mb-1">2026ë…„ ì´ˆê¸‰ê°„ë¶€ ë‹¹ì§ê·¼ë¬´ë¹„ ì¸ìƒ í™•ì • ë° ì§€ê¸‰ ì‹œê¸° ì•ˆë‚´</h3>
                        <p class="text-[11px] text-gray-500 line-clamp-1 leading-relaxed">ì˜¬í•´ë¶€í„° í‰ì¼ 2ë§Œì›, ì£¼ë§ 4ë§Œì›ìœ¼ë¡œ ì¸ìƒëœ ë‹¹ì§ë¹„ê°€ 1ì›” ê¸‰ì—¬ë¶€í„° ì†Œê¸‰ ì ìš©ë©ë‹ˆë‹¤.</p>
                    </div>

                    <div class="group cursor-pointer p-4 bg-black/20 rounded-xl border border-gray-800 hover:border-[#8a9a5b] transition-all">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[9px] bg-blue-600 text-white px-2 py-0.5 rounded font-bold uppercase tracking-tighter">êµ°ì¸ê°€ì¡±</span>
                            <span class="text-[10px] text-gray-600 font-medium">2026.01.03</span>
                        </div>
                        <h3 class="font-bold text-sm group-hover:text-[#8a9a5b] mb-1">êµ°ì¸ ìë…€ êµìœ¡ì§€ì›ê¸ˆ ë° í˜¸êµ­ì¥í•™ê¸ˆ ì‹ ì²­ ì„œë¥˜ ì•ˆë‚´</h3>
                        <p class="text-[11px] text-gray-500 line-clamp-1 leading-relaxed">ìë…€ ì¥í•™ê¸ˆ ì‹ ì²­ì„ ìœ„í•œ ë³µë¬´í™•ì¸ì„œ ë° ì„±ì  ì¦ëª…ì„œ ì œì¶œ ê¸°í•œì„ í™•ì¸í•˜ì„¸ìš”.</p>
                    </div>
                </div>
            </section>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <section class="bg-card p-6 rounded-2xl shadow-xl border-b border-[#8a9a5b]/30">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fa-solid fa-cart-shopping accent-khaki"></i> ì˜ì™¸ë§ˆíŠ¸(WA) í˜„í™©
                        </h3>
                        <div class="relative w-full md:w-40">
                            <input type="text" id="waSearch" placeholder="ì§€ì—­ëª… ê²€ìƒ‰" 
                                class="w-full bg-black/50 border border-gray-700 px-3 py-1.5 rounded-xl text-[10px] focus:border-[#8a9a5b] outline-none">
                        </div>
                    </div>
                    <div id="waList" class="grid grid-cols-1 gap-3 max-h-[400px] overflow-y-auto pr-2">
                        <p class="text-center py-10 text-gray-600 animate-pulse text-[10px]">ì •ë³´ ë™ê¸°í™” ì¤‘...</p>
                    </div>
                </section>

                <section class="bg-card p-5 rounded-2xl">
                    <h3 class="text-sm font-bold mb-4 flex items-center gap-2 border-b border-gray-800 pb-2">
                        <i class="fa-solid fa-house-user accent-khaki"></i> êµ° íŠ¹ë³„ê³µê¸‰ ê³µê³ 
                    </h3>
                    <ul class="text-[11px] space-y-3">
                        <li class="truncate text-gray-400 hover:text-[#8a9a5b] cursor-pointer leading-relaxed">â€¢ [ê³µê³ ] íŒŒì£¼ ìš´ì • 3ì§€êµ¬ A-44 êµ°íŠ¹ê³µ</li>
                        <li class="truncate text-gray-400 hover:text-[#8a9a5b] cursor-pointer leading-relaxed">â€¢ [ê³µê³ ] í™”ì„± ë™íƒ„2 A-94ë¸”ë¡ íŠ¹ë³„ê³µê¸‰</li>
                        <li class="truncate text-gray-400 hover:text-[#8a9a5b] cursor-pointer leading-relaxed">â€¢ [ì•ˆë‚´] 26ë…„ 1ë¶„ê¸° ê²½ê¸°ì§€ì—­ ì˜ˆì •ê³µê³ </li>
                    </ul>
                </section>
            </div>
        </div>

        <div class="xl:col-span-1">
            <section class="bg-card p-5 rounded-2xl h-[650px] flex flex-col shadow-2xl relative">
                <h2 class="text-sm font-bold mb-4 accent-khaki border-b border-gray-800 pb-2 uppercase tracking-widest flex items-center gap-2">
                    <i class="fa-solid fa-comments text-[10px]"></i> Live Talk
                </h2>
                <div id="msgBox" class="flex-1 overflow-y-auto space-y-4 mb-4 pr-1 text-[11px]">
                    <div class="bg-black/30 p-3 rounded-xl border border-gray-800 text-center">
                        <p class="text-gray-500 text-[10px]">ë³´ì•ˆ ê·œì •ì„ ì¤€ìˆ˜í•´ ì£¼ì„¸ìš” ğŸª–</p>
                    </div>
                </div>
                <div class="mt-auto">
                    <div class="flex gap-2">
                        <input type="text" id="chatInput" placeholder="ë§¤ë„ˆ ì±„íŒ… ë¶€íƒë“œë¦½ë‹ˆë‹¤." 
                            class="flex-1 bg-black border border-gray-700 p-2.5 rounded-xl text-xs outline-none focus:border-[#8a9a5b] transition-all">
                        <button onclick="sendChat()" class="btn-khaki px-4 rounded-xl hover:bg-[#a6b67d] transition-colors">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="max-w-7xl mx-auto mt-12 py-8 border-t border-gray-800 text-center text-gray-600 text-[10px]">
        <p>Â© 2026 í–‰êµ°(Happy Military). All Rights Reserved.</p>
        <p class="mt-1 font-bold">ë³¸ ì‚¬ì´íŠ¸ëŠ” êµ°ì‚¬ë³´ì•ˆ ê·œì •ì„ ì¤€ìˆ˜í•˜ë©°, ë³´ì•ˆ ìœ„ë°° ê²Œì‹œë¬¼ì€ ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤.</p>
    </footer>

<script>

// [ë¡œê·¸ì¸ ë° ìœ ì € ë°ì´í„° ì²˜ë¦¬]
        async function loginWithGoogle() {
            try {
                const result = await signInWithPopup(window.auth, window.provider);
                const user = result.user;
                
                // Firestoreì—ì„œ ê¸°ì¡´ ìœ ì € ì •ë³´ í™•ì¸
                const userRef = doc(window.db, "users", user.uid);
                const userSnap = await getDoc(userRef);

                if (!userSnap.exists()) {
                    // ì‹ ê·œ íšŒì›: ì¶”ê°€ ì •ë³´ ì…ë ¥ (ì„±ë³„, ìƒë…„ì›”ì¼ ë“±)
                    const birth = prompt("ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: 19980520)");
                    const gender = prompt("ì„±ë³„ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ë‚¨/ì—¬)");
                    
                    const newUser = {
                        uid: user.uid,
                        name: user.displayName,
                        email: user.email,
                        nickname: user.displayName, // ê¸°ë³¸ ë‹‰ë„¤ì„ì€ êµ¬ê¸€ ì´ë¦„
                        birth: birth,
                        gender: gender,
                        is_nickname_changed: false, // ë‹‰ë„¤ì„ ìˆ˜ì • 1íšŒ ì œí•œìš©
                        nickname_style: "color: #ffffff", // ê¸°ë³¸ í°ìƒ‰
                        role: "user"
                    };
                    
                    await setDoc(userRef, newUser);
                    currentUser = newUser;
                } else {
                    // ê¸°ì¡´ íšŒì›
                    currentUser = userSnap.data();
                }
                
                updateAuthUI();
                alert(`${currentUser.nickname}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`);
            } catch (error) {
                console.error("ë¡œê·¸ì¸ ì‹¤íŒ¨:", error);
            }
        }

        // [ë‹‰ë„¤ì„ ìˆ˜ì • ê¸°ëŠ¥ - 1íšŒ ì œí•œ]
        async function changeNickname() {
            if (currentUser.is_nickname_changed) {
                alert("ë‹‰ë„¤ì„ ë³€ê²½ ê¶Œí•œì„ ì´ë¯¸ ì‚¬ìš©í•˜ì…¨ìŠµë‹ˆë‹¤. ì¶”ê°€ ë³€ê²½ì€ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
                return;
            }

            const newName = prompt("ìƒˆë¡œìš´ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš” (1íšŒ í•œì •)");
            if (newName && newName.length >= 2) {
                const userRef = doc(window.db, "users", currentUser.uid);
                await updateDoc(userRef, {
                    nickname: newName,
                    is_nickname_changed: true
                });
                
                currentUser.nickname = newName;
                currentUser.is_nickname_changed = true;
                updateAuthUI();
                alert("ë‹‰ë„¤ì„ì´ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }

        // [ë¡œê·¸ì•„ì›ƒ]
        function handleLogout() {
            signOut(window.auth).then(() => {
                location.reload();
            });
        }

// 1. ì „ì—­ ë³€ìˆ˜ í™•ì¥
        let allMarts = [];
        let currentUser = null; // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì €ì¥

// 2. ë§ˆíŠ¸ ë Œë”ë§ í•¨ìˆ˜ (XML í•„ë“œëª… MART, LOC, TEL ëŒ€ì‘)
        function renderMarts(marts) {
            const listContainer = document.getElementById('waList');
            if (!listContainer) return;

            const now = new Date();
            const curTime = now.getHours() * 100 + now.getMinutes();
            const day = now.getDay(); 

            if (!marts || marts.length === 0) {
                listContainer.innerHTML = `<p class="text-center text-[10px] text-gray-500 py-4">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ê±°ë‚˜ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }

            listContainer.innerHTML = marts.map(mart => {
                let openTime = 900, closeTime = 1800;
                let isHoliday = (day === 0);
                if (day === 6) closeTime = 1500;

                let status = { text: "ìš´ì˜ ì¢…ë£Œ", color: "text-red-500", dot: "bg-red-500" };
                if (!isHoliday && curTime >= openTime && curTime < closeTime) {
                    if (curTime >= 1200 && curTime < 1300) {
                        status = { text: "ì ì‹¬ ì‹œê°„", color: "text-yellow-500", dot: "bg-yellow-500" };
                    } else {
                        status = { text: "ìš´ì˜ ì¤‘", color: "text-green-500", dot: "bg-green-500 animate-pulse" };
                    }
                } else if (isHoliday) { status.text = "ì •ê¸° íœ´ë¬´"; }

                // XML íƒœê·¸ëª…ì— ë§ì¶° ë°ì´í„° ì¶”ì¶œ
                const name = mart.querySelector('MART')?.textContent || "ì´ë¦„ ì—†ìŒ";
                const addr = mart.querySelector('LOC')?.textContent || "ì£¼ì†Œ ì—†ìŒ";
                const tel = mart.querySelector('TEL')?.textContent || "";

                return `
                    <div class="flex flex-col p-3 bg-black/20 rounded-xl border border-gray-800 hover:border-[#8a9a5b]/50 transition-all">
                        <div class="flex justify-between items-start mb-1">
                            <h4 class="text-[12px] font-bold text-white">${name}</h4>
                            <span class="flex items-center gap-1 text-[9px] font-bold ${status.color}">
                                <span class="w-1.5 h-1.5 rounded-full ${status.dot}"></span>${status.text}
                            </span>
                        </div>
                        <p class="text-[9px] text-gray-500 truncate mb-2">${addr}</p>
                        <div class="flex justify-between items-center text-[9px]">
                             <span class="text-gray-600">Tel: ${tel || 'ì •ë³´ì—†ìŒ'}</span>
                             ${tel ? `<a href="tel:${tel}" class="accent-khaki font-bold">ì „í™”í•˜ê¸°</a>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 3. API í˜¸ì¶œ í•¨ìˆ˜ (XML íŒŒì‹± + END_INDEX 999 ì„¤ì •)
        async function fetchWAMarts() {
            const listContainer = document.getElementById('waList');
            const myKey = "3231313637393730303336333832313035";
            
            // XML í˜•ì‹ìœ¼ë¡œ 999ê°œê¹Œì§€ ìš”ì²­
            const apiUrl = `https://openapi.mnd.go.kr/${myKey}/xml/TB_MND_MART_CURRENT/1/999/`;
            const targetUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(apiUrl)}`;

            try {
                const response = await fetch(targetUrl);
                if (!response.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì‹¤íŒ¨');
                
                const data = await response.json();
                
                if (data && data.contents) {
                    // XML ë¬¸ìì—´ì„ DOM ê°ì²´ë¡œ íŒŒì‹±
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(data.contents, "text/xml");
                    
                    // <row> íƒœê·¸ë“¤ì„ ëª¨ë‘ ì°¾ìŒ
                    const rows = Array.from(xmlDoc.querySelectorAll('row'));
                    
                    if (rows.length > 0) {
                        allMarts = rows; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                        renderMarts(allMarts);
                        console.log(`${rows.length}ê°œì˜ ë§ˆíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
                    } else {
                        throw new Error('ë°ì´í„° ì‘ë‹µì€ ì™”ìœ¼ë‚˜ ë§ˆíŠ¸ ëª©ë¡ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                    }
                }
            } catch (error) {
                console.error("ìµœì¢… ë¡œë“œ ì‹¤íŒ¨:", error);
                if (listContainer) {
                    listContainer.innerHTML = `
                        <div class="col-span-full text-center py-10">
                            <p class="text-[10px] text-gray-500 mb-2">ë§ˆíŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p class="text-[9px] text-red-400 opacity-70">${error.message}</p>
                        </div>`;
                }
            }
        }

// 4. ì´ë²¤íŠ¸ ë° ì´ˆê¸°í™” (XML ë…¸ë“œ ê²€ìƒ‰ ìµœì í™”)
        document.addEventListener('DOMContentLoaded', () => {
            fetchWAMarts();
            
            // ê²€ìƒ‰ ì´ë²¤íŠ¸: XML êµ¬ì¡°ì— ë§ì¶° í…ìŠ¤íŠ¸ ì¶”ì¶œ í›„ ë¹„êµ
            document.getElementById('waSearch').addEventListener('input', (e) => {
                const keyword = e.target.value.toLowerCase().trim();
                
                // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ëª©ë¡ í‘œì‹œ
                if (!keyword) {
                    renderMarts(allMarts);
                    return;
                }

                const filtered = allMarts.filter(mart => {
                    // XML ë…¸ë“œì—ì„œ MART(ì´ë¦„)ì™€ LOC(ì£¼ì†Œ) íƒœê·¸ì˜ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ì—¬ ë¹„êµ
                    const name = mart.querySelector('MART')?.textContent.toLowerCase() || "";
                    const addr = mart.querySelector('LOC')?.textContent.toLowerCase() || "";
                    
                    return name.includes(keyword) || addr.includes(keyword);
                });

                renderMarts(filtered);
            });
        });

// 5. ì±„íŒ… ê¸°ëŠ¥ (ë¡œê·¸ì¸ ì²´í¬ ì¶”ê°€)
        function sendChat() {
            if (!currentUser) {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ìƒë‹¨ì˜ ì†Œì…œ ë¡œê·¸ì¸ì„ ì´ìš©í•´ ì£¼ì„¸ìš”.");
                return;
            }
            
            const input = document.getElementById('chatInput');
            if(!input.value) return;
            
            // ìœ ì €ì˜ ë‹‰ë„¤ì„ ìŠ¤íƒ€ì¼(ìƒ‰ìƒ/íš¨ê³¼) ì ìš©
            const style = currentUser.nickname_style || "color: white";
            const nickname = currentUser.nickname || "ìµëª…";

            const box = document.getElementById('msgBox');
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const msgHtml = `
                <div class="flex flex-col items-end animate-fade-in mb-4">
                    <span class="text-[9px] mb-1 font-bold" style="${style}">${nickname}</span>
                    <div class="bg-[#8a9a5b] text-black p-2.5 rounded-2xl rounded-tr-none max-w-[90%] font-medium">
                        ${input.value}
                    </div>
                    <span class="text-[8px] text-gray-600 mt-1">${time}</span>
                </div>
            `;
            box.insertAdjacentHTML('beforeend', msgHtml);
            input.value = "";
            box.scrollTop = box.scrollHeight;
        }

// 6. íšŒì› ê´€ë¦¬ ì‹œìŠ¤í…œ ë¡œì§
        function handleLogin(platform) {
            // ì‹¤ì œ êµ¬í˜„ì‹œì—ëŠ” ê° í”Œë«í¼ì˜ SDK(Firebase ë“±)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
            console.log(`${platform} ë¡œê·¸ì¸ ì‹œë„...`);
            
            // ê°€ìƒì˜ ë¡œê·¸ì¸ ì„±ê³µ ë°ì´í„° (DBì—ì„œ ê°€ì ¸ì˜¬ ë‚´ìš©)
            currentUser = {
                uid: "user123",
                name: "í™ê¸¸ë™",
                birth: "1998-05-20",
                gender: "ë‚¨",
                nickname: "ëŒ€í•œìœ¡êµ°", 
                is_nickname_changed: false, // ë‹‰ë„¤ì„ ë³€ê²½ ì—¬ë¶€ ì²´í¬
                nickname_style: "color: #ffda44; text-shadow: 0 0 5px rgba(255,218,68,0.5);", // ê´€ë¦¬ìê°€ ë¶€ì—¬í•œ íš¨ê³¼
                role: "user" // ê´€ë¦¬ìëŠ” "admin"
            };

            updateAuthUI();
        }

        // ë¡œê·¸ì¸ ì„±ê³µ í›„ UI ë³€ê²½
        function updateAuthUI() {
            const authArea = document.getElementById('authArea');
            authArea.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="text-right hidden md:block">
                        <p class="text-[10px] font-bold text-white" style="${currentUser.nickname_style}">${currentUser.nickname}</p>
                        <p class="text-[8px] text-gray-500">${currentUser.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤</p>
                    </div>
                    <button onclick="openProfileModal()" class="w-8 h-8 rounded-full bg-gray-700 border border-[#8a9a5b] flex items-center justify-center">
                        <i class="fa-solid fa-user text-xs"></i>
                    </button>
                    <button onclick="location.reload()" class="text-[9px] text-gray-400 hover:text-white">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            `;
        }

        // ë‹‰ë„¤ì„ ìˆ˜ì • í•¨ìˆ˜ (1íšŒ ì œí•œ ì ìš©)
        function updateNickname(newNickname) {
            if (currentUser.is_nickname_changed) {
                alert("ë‹‰ë„¤ì„ì€ 1íšŒë§Œ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ ë³€ê²½ì€ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
                return;
            }
            
            currentUser.nickname = newNickname;
            currentUser.is_nickname_changed = true; // ë³€ê²½ ì™„ë£Œ í‘œì‹œ
            alert("ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
            updateAuthUI();
        }

        document.getElementById('chatInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') sendChat(); });
        setInterval(() => { if(allMarts.length > 0) renderMarts(allMarts); }, 60000);
    </script>
</body>
</html>
